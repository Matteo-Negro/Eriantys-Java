% !TeX encoding = UTF-8
% !TeX spellcheck = en_GB

\documentclass[a4paper]{article}

\pdfminorversion=7
\pdfcompresslevel=9
\pdfobjcompresslevel=2

\usepackage[hidelinks]{hyperref}
\usepackage[margin=70pt]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage[underline=false]{pgf-umlsd}
\usepackage{minted}
\usepackage{multicol}
\usepackage{tikz}

\usetikzlibrary{arrows, shadings}

\setlength{\parindent}{0pt}

\title{\textbf{Eriantys Protocol Documentation}}
\author{Riccardo Milici, Riccardo Motta, Matteo Negro\\Group 2}
\date{A.Y. 2021 - 2022}

\hypersetup{
	pdftitle={Eriantys Protocol Documentation},
	pdfauthor={Riccardo Milici, Riccardo Motta, Matteo Negro}
}

\begin{document}

	\maketitle

	\section{Messages}

	\subsection{Ping}

	This message is sent from the server to each client in order to check if they're still online.
	
	\begin{multicols}{2}
		
		\paragraph{Request}
		
		\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "ping"
}
		\end{minted}
	
		\paragraph{Response}
		
		\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "pong"
}
		\end{minted}
	
	\end{multicols}

	\subsection{Error}
	
	This message is sent whenever an error occurs.
	
	\paragraph{Request} Parameters:
	
	\begin{itemize}
		\item \verb|message|: the message which describes what happened.
	\end{itemize}
	
	\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "error",
	"message": "Message"
}
	\end{minted}

	\paragraph{Response} This message doesn't require a response.

	\subsection{Refill}

	This message is sent from a specific client to the server (which then redirects the same massage to all the other clients to update their views) when the player, at the end of his/her turn, takes the students from a cloud to refill the entrance.
	
	\paragraph{Request} Parameters:
	
	\begin{itemize}
		\item \verb|player|: the name of the player that takes the students.
		\item \verb|cloud|: the cloud from which the player takes the students.
	\end{itemize}
	
	\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "command",
	"subtype": "refill",
	"player": "Player 1",
	"cloud": 0
}
	\end{minted}
	
	\paragraph{Response} This message doesn't require a response.
	
	\subsection{Refill cloud}
	
	This message is sent from the server to each client to indicate which cloud has to be refilled of students and which of them will be added to it.
	
	\paragraph{Request} Parameters:

	\begin{itemize}
		\item \verb|cloud|: id of the cloud to refill.
		\item \verb|students|: number of students to add to the cloud, divided by colour.
	\end{itemize}

	\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "command",
	"subtype": "refillCloud",
	"cloud": 0,
	"students": {
		"BLUE": 1,
		"FUCHSIA": 0,
		"GREEN": 1,
		"RED": 0,
		"YELLOW": 1
	}
}
	\end{minted}
	
	\paragraph{Response} This message doesn't require a response.
	
	\subsection{End game}
	
	This message is sent from the server to each clients in order to indicate that the game is ended.
	
	\paragraph{Request} Parameters:
	
	\begin{itemize}
		\item \verb|winner|: the name of the player who won the game. This could be either a \verb|string| with the name, or \mintinline{json}{null} if the game ends tie.
	\end{itemize}

	\begin{multicols}{2}
		\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "end",
	"winner": "Player 1"
}
		\end{minted}
		\begin{minted}[samepage, tabsize=4]{json}
{
	"type": "end",
	"winner": null
}
		\end{minted}
	\end{multicols}
	
	\paragraph{Response} This message doesn't require a response.
	
	\section{Scenarios}
	
	\subsection{Action phase, move \#3}
	
	\begin{center}
		\begin{sequencediagram}
			\newthread{c1}{client1: Client}
			\newinst{c2}{clientN: Client}
			\newinst[2]{u1}{user1: User}
			\newinst{u2}{userN: User}
			\newthread{g}{game: Game}
			
			\begin{call}{c1}{sendMessage(refill)}{u1}{implicit ack}
				\begin{call}{u1}{getCommand()}{u1}{command}
				\end{call}
				\begin{call}{u1}{refillEntrance()}{g}{implicit ack}
				\end{call}
			\end{call}
			\begin{call}{g}{notifyAll()}{u2}{implicit ack}
				\begin{call}{u2}{sendMessage(refill)}{c2}{implicit ack}
				\end{call}
			\end{call}
		\end{sequencediagram}
	\end{center}
	
	This scenario represents the last action the player can do during his/her turn. The client behind that player send a message telling the server that s/he took the students from a specific cloud to refill his/her school entrance. The server, once receive the message, sends it back to every other client (here generically represented as \verb|clientN|) in order to let them update their views.
	
	\subsection{Game end}
	
	\begin{center}
		\begin{sequencediagram}
			\newinst{c}{client: Client}
			\newinst[2]{u}{user: User}
			\newthread{g}{game: Game}
			
			\begin{call}{g}{notifyAll()}{u}{implicit ack}
				\begin{call}{u}{sendMessage(end)}{c}{implicit ack}
				\end{call}
			\end{call}
		\end{sequencediagram}
	\end{center}
	
	This scenarios represents the notification that the game has reached a point where it's concluded. In this case, the server notifies every client that the game has ended and if there is a winner, tells every client who is, otherwise says that the game ended tie.
	
\end{document}
